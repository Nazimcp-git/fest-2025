<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Information Hub</title>
    
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Phosphor Icons for a nice touch -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    
    <style>
        body { font-family: 'Inter', sans-serif; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }
        .form-container {
            transition: all 0.3s ease-in-out;
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-800">

    <!-- Login Overlay -->
    <div id="login-overlay" class="fixed inset-0 bg-slate-900 bg-opacity-80 flex items-center justify-center p-4 z-50">
        <div class="bg-white p-8 rounded-2xl shadow-2xl w-full max-w-sm text-center">
            <i class="ph-fill ph-lock text-5xl text-sky-500 mb-4"></i>
            <h2 class="text-2xl font-bold mb-2 text-slate-900">Admin Access</h2>
            <p class="text-slate-500 mb-6">Please enter the password to continue.</p>
            <form id="login-form">
                <input type="password" id="password" class="bg-slate-100 text-center border border-slate-300 text-slate-900 text-sm rounded-lg focus:ring-sky-500 focus:border-sky-500 block w-full p-2.5 mb-4" placeholder="••••••••" required>
                <button type="submit" class="w-full text-white bg-sky-600 hover:bg-sky-700 font-medium rounded-lg text-sm px-5 py-3">Unlock</button>
                <p id="login-error" class="text-red-500 text-sm mt-3 h-4"></p>
            </form>
        </div>
    </div>

    <!-- Main Admin Dashboard (Initially Hidden) -->
    <div id="admin-dashboard" class="hidden min-h-screen container mx-auto p-4 md:p-8">
        
        <!-- Header -->
        <header class="flex flex-col sm:flex-row justify-between items-start mb-8 gap-4">
            <div>
                <div class="flex items-center gap-3">
                    <i class="ph-fill ph-user-gear text-4xl text-sky-500"></i>
                    <h1 class="text-3xl font-bold text-slate-900">Admin Dashboard</h1>
                </div>
                <p class="text-slate-500 mt-1">Manage notifications and document uploads.</p>
            </div>
             
        </header>

        <!-- Main Content Area -->
        <main class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            
            <!-- Notifications Panel -->
            <div class="form-container bg-white p-6 md:p-8 rounded-2xl shadow-lg border border-slate-200">
                <h2 class="text-xl font-bold mb-5 text-slate-900">Post a New Notification</h2>
                <form id="notification-form" class="space-y-4">
                    <div>
                        <label for="title" class="block mb-2 text-sm font-medium text-slate-600">Title</label>
                        <input type="text" id="title" class="bg-slate-100 border border-slate-300 text-slate-900 text-sm rounded-lg focus:ring-sky-500 focus:border-sky-500 block w-full p-2.5" required>
                    </div>
                    <div>
                        <label for="content" class="block mb-2 text-sm font-medium text-slate-600">Content</label>
                        <textarea id="content" rows="4" class="bg-slate-100 border border-slate-300 text-slate-900 text-sm rounded-lg focus:ring-sky-500 focus:border-sky-500 block w-full p-2.5" required></textarea>
                    </div>
                    <div>
                        <label for="link" class="block mb-2 text-sm font-medium text-slate-600">Link (Optional)</label>
                        <input type="url" id="link" class="bg-slate-100 border border-slate-300 text-slate-900 text-sm rounded-lg focus:ring-sky-500 focus:border-sky-500 block w-full p-2.5">
                    </div>
                    <button type="submit" class="w-full text-white bg-sky-600 hover:bg-sky-700 font-medium rounded-lg text-sm px-5 py-3 text-center">Post Notification</button>
                </form>
            </div>

            <!-- Downloads Panel -->
            <div class="form-container bg-white p-6 md:p-8 rounded-2xl shadow-lg border border-slate-200">
                <h2 class="text-xl font-bold mb-5 text-slate-900">Upload a New Document</h2>
                <form id="download-form" class="space-y-4">
                    <div>
                        <label for="heading" class="block mb-2 text-sm font-medium text-slate-600">Document Heading</label>
                        <input type="text" id="heading" class="bg-slate-100 border border-slate-300 text-slate-900 text-sm rounded-lg focus:ring-sky-500 focus:border-sky-500 block w-full p-2.5" required>
                    </div>
                    <div>
                        <label for="file" class="block mb-2 text-sm font-medium text-slate-600">File</label>
                        <input type="file" id="file" class="block w-full text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-sky-50 file:text-sky-700 hover:file:bg-sky-100" required>
                    </div>
                     <div id="upload-progress-container" class="hidden w-full bg-slate-200 rounded-full h-2.5">
                        <div id="upload-progress-bar" class="bg-sky-600 h-2.5 rounded-full" style="width: 0%"></div>
                    </div>
                    <button type="submit" id="upload-btn" class="w-full text-white bg-sky-600 hover:bg-sky-700 font-medium rounded-lg text-sm px-5 py-3 text-center flex items-center justify-center gap-2">
                        <i class="ph ph-upload-simple"></i>
                        <span>Upload Document</span>
                    </button>
                </form>
            </div>
        </main>
    </div>
    
    <!-- Toast Notification for feedback -->
    <div id="toast" class="hidden fixed bottom-5 right-5 bg-green-500 text-white py-3 px-6 rounded-lg shadow-lg z-50 transition-transform duration-300 transform translate-y-20">
        <p id="toast-message"></p>
    </div>

    <!-- Firebase SDKs (v8.10.0) -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>

    <script type="module">
        // --- IMPORTANT: CONFIGURE FIREBASE HERE ---
        const firebaseConfig = {
             apiKey: "AIzaSyBXJ_RnfjUDi7qPDATWVnS5lSFw6jVRYgo",
            authDomain: "shopping-e284c.firebaseapp.com",
            databaseURL: "https://shopping-e284c-default-rtdb.firebaseio.com",
            projectId: "shopping-e284c",
            storageBucket: "shopping-e284c.appspot.com",
            messagingSenderId: "248274428739",
            appId: "1:248274428739:web:fc30dd9eb1ef83f610c5f6",
            measurementId: "G-ZXZCK9BW7T"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const auth = firebase.auth();
        const storage = firebase.storage();

        // --- DOM ELEMENT REFERENCES ---
        const loginOverlay = document.getElementById('login-overlay');
        const loginForm = document.getElementById('login-form');
        const loginError = document.getElementById('login-error');
        const adminDashboard = document.getElementById('admin-dashboard');
        const notificationForm = document.getElementById('notification-form');
        const downloadForm = document.getElementById('download-form');
        const toast = document.getElementById('toast');
        const toastMessage = document.getElementById('toast-message');
        const uploadProgressContainer = document.getElementById('upload-progress-container');
        const uploadProgressBar = document.getElementById('upload-progress-bar');
        const uploadBtn = document.getElementById('upload-btn');

        // --- AUTHENTICATION ---
        auth.signInAnonymously().catch((error) => {
            console.error("Anonymous sign-in failed:", error);
            showToast('Could not connect to the service.', 'error');
        });

        // --- UI LOGIC ---
        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const password = loginForm.password.value;
            if (password === 'admin123') {
                loginOverlay.classList.add('hidden');
                adminDashboard.classList.remove('hidden');
            } else {
                loginError.textContent = 'Incorrect password.';
                setTimeout(() => loginError.textContent = '', 2000);
            }
        });

        function showToast(message, type = 'success') {
            toastMessage.textContent = message;
            toast.classList.remove('hidden', 'bg-green-500', 'bg-red-500', 'translate-y-20');
            if (type === 'success') toast.classList.add('bg-green-500');
            else toast.classList.add('bg-red-500');
            
            // Slide in
            toast.classList.remove('translate-y-20');

            setTimeout(() => {
                // Slide out
                toast.classList.add('translate-y-20');
                setTimeout(() => toast.classList.add('hidden'), 300);
            }, 3000);
        }
        
        // --- FORM SUBMISSIONS ---
        notificationForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const { title, content, link } = e.target.elements;
            const submitBtn = e.target.querySelector('button[type="submit"]');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Posting...';

            try {
                await db.ref('notifications').push().set({
                    title: title.value,
                    content: content.value,
                    link: link.value,
                    timestamp: firebase.database.ServerValue.TIMESTAMP
                });
                notificationForm.reset();
                showToast('Notification posted successfully!', 'success');
            } catch (error) {
                console.error("Error adding notification: ", error);
                showToast('Failed to post notification.', 'error');
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Post Notification';
            }
        });

        downloadForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const heading = downloadForm.heading.value;
            const file = downloadForm.file.files[0];
            if (!file) {
                showToast('Please select a file to upload.', 'error');
                return;
            }

            uploadBtn.disabled = true;
            uploadBtn.innerHTML = `<div class="w-5 h-5 border-2 border-dashed rounded-full animate-spin border-white"></div><span>Uploading...</span>`;
            uploadProgressContainer.classList.remove('hidden');

            const storageRef = storage.ref(`downloads/${Date.now()}_${file.name}`);
            const uploadTask = storageRef.put(file);

            uploadTask.on('state_changed', 
                (snapshot) => {
                    const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                    uploadProgressBar.style.width = progress + '%';
                }, 
                (error) => {
                    console.error('Upload failed:', error);
                    showToast(`Upload failed: ${error.message}`, 'error');
                    resetUploadButton();
                }, 
                () => {
                    uploadTask.snapshot.ref.getDownloadURL().then(async (downloadURL) => {
                        await db.ref('downloads').push().set({
                            heading: heading,
                            filename: file.name,
                            url: downloadURL,
                            timestamp: firebase.database.ServerValue.TIMESTAMP
                        });
                        downloadForm.reset();
                        showToast('Document uploaded successfully!', 'success');
                        resetUploadButton();
                    });
                }
            );
        });

        function resetUploadButton() {
            uploadBtn.disabled = false;
            uploadBtn.innerHTML = `<i class="ph ph-upload-simple"></i><span>Upload Document</span>`;
            uploadProgressContainer.classList.add('hidden');
            uploadProgressBar.style.width = '0%';
        }
    </script>
</body>
</html>
